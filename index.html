<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”® ì‚¬ë‹¤ë¦¬ ë¸”ëŸ­ ì˜ˆì¸¡ ê²°ê³¼</title>
  <style>
    body { font-family: "Noto Sans KR", sans-serif; background: #f4f7ff; padding: 2rem; }
    h1 { font-size: 1.8rem; text-align: center; margin-bottom: 2rem; }
    .tabs { display: flex; justify-content: center; margin-bottom: 1rem; gap: 1rem; }
    .tabs button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.6rem;
      background: #e0e7ff;
      cursor: pointer;
    }
    .tabs button.active { background: #6366f1; color: white; }
    .card-grid { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; }
    .card {
      background: white;
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
      width: 320px;
    }
    .card h3 { margin: 0.5rem 0; font-size: 1.05rem; }
    .card p { margin: 0.3rem 0; font-size: 0.95rem; }
    h2 { font-size: 1.3rem; margin-top: 2rem; margin-bottom: 1rem; text-align: center; }
    table { margin: 1rem auto; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 0.4rem 0.8rem; }
    th { background: #eef; }
  </style>
</head>
<body>
  <h1>ğŸ”® ì‚¬ë‹¤ë¦¬ ë¸”ëŸ­ ì˜ˆì¸¡ ê²°ê³¼</h1>
  <div id="summary"></div>
  <div class="tabs">
    <button onclick="showTab('ìƒë‹¨')" class="active">Top3 ìƒë‹¨ê°’</button>
    <button onclick="showTab('í•˜ë‹¨')">Top3 í•˜ë‹¨ê°’</button>
  </div>
  <div id="block-root"></div>

  <script>
    const modes = [
      [6, "6block"],
      [5, "5block"],
      [4, "4block"],
      [3, "3block"]
    ];
    const transforms = [
      ["", "ì›ë³¸"],
      ["_flip_full", "ì™„ì „ ëŒ€ì¹­"],
      ["_flip_start", "ì‹œì‘ì  ë°˜ì „"],
      ["_flip_odd_even", "í™€ì§ ë°˜ì „"]
    ];

    let currentTab = "ìƒë‹¨";

    async function showTab(tab) {
      currentTab = tab;
      document.querySelectorAll(".tabs button").forEach(btn => btn.classList.remove("active"));
      document.querySelector(`.tabs button:contains('${tab}')`)?.classList.add("active");
      render();
    }

    function render() {
      const container = document.getElementById("block-root");
      container.innerHTML = "";
      dataBlocks.forEach(group => {
        const sectionTitle = document.createElement("h2");
        sectionTitle.textContent = `${group.ì¤„ìˆ˜}ì¤„ ë¸”ëŸ­`;
        container.appendChild(sectionTitle);

        group.ë¸”ëŸ­ë“¤.forEach(block => {
          const card = document.createElement("div");
          card.className = "card";

          const title = document.createElement("h3");
          title.textContent = `${group.ì¤„ìˆ˜}ì¤„ ë¸”ëŸ­ (${block.ì´ë¦„}) (íšŒì°¨ ${block.íšŒì°¨})`;
          card.appendChild(title);

          const values = block[currentTab + "ê°’ë“¤"] || [];
          if (!values.length) {
            const p = document.createElement("p");
            p.textContent = "âŒ ì—†ìŒ";
            card.appendChild(p);
          }

          values.forEach((v, idx) => {
            const p = document.createElement("p");
            p.textContent = `${idx + 1}. ${v.ê°’} | ë¸”ëŸ­: ${v.ë¸”ëŸ­} | ìˆœë²ˆ: ${v.ìˆœë²ˆ}`;
            card.appendChild(p);
          });

          container.appendChild(card);
        });
      });
    }

    let dataBlocks = [];

    async function load() {
      const summaryRes = await fetch("/predict_top3_summary");
      const summaryData = await summaryRes.json();

      const summaryEl = document.getElementById("summary");
      const table = document.createElement("table");
      const header = document.createElement("tr");
      header.innerHTML = "<th>ë¸”ëŸ­</th><th>Top3 ìƒë‹¨ê°’</th><th>Top3 í•˜ë‹¨ê°’</th>";
      table.appendChild(header);

      for (const [key, val] of Object.entries(summaryData)) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${key}</td><td>${val.Top3ìƒë‹¨?.join(", ")}</td><td>${val.Top3í•˜ë‹¨?.join(", ")}</td>`;
        table.appendChild(tr);
      }
      summaryEl.appendChild(table);

      const blocks = [];
      for (const [size, prefix] of modes) {
        const group = { ì¤„ìˆ˜: size, ë¸”ëŸ­ë“¤: [] };
        for (const [suffix, name] of transforms) {
          const res = await fetch(`/predict?mode=${prefix}${suffix}`);
          const json = await res.json();
          group.ë¸”ëŸ­ë“¤.push({ ì´ë¦„: name, íšŒì°¨: json.ì˜ˆì¸¡íšŒì°¨, ìƒë‹¨ê°’ë“¤: json.ìƒë‹¨ê°’ë“¤, í•˜ë‹¨ê°’ë“¤: json.í•˜ë‹¨ê°’ë“¤ });
        }
        blocks.push(group);
      }
      dataBlocks = blocks;
      render();
    }

    load();
  </script>
</body>
</html>
